!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("vue")):"function"==typeof define&&define.amd?define(["vue"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).VirtualDragList=e(t.Vue)}(this,function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}t=e(t);function i(e,t){var i,n=Object.keys(e);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(e),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)),n}function y(n){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach(function(t){var e,i;e=n,i=o[t=t],(t=l(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(o,t))})}return n}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}function r(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){var i;if(t)return"string"==typeof t?a(t,e):"Map"===(i="Object"===(i=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(t,e):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function l(t){t=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);if("object"!=typeof(i=i.call(t,e||"default")))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}var h={dataSource:{type:Array,default:function(){return[]}},dataKey:{type:String,required:!0},direction:{type:String,default:"vertical"},keeps:{type:Number,default:30},size:{type:Number},delay:{type:Number,default:10},rootTag:{type:String,default:"div"},wrapTag:{type:String,default:"div"},wrapClass:{type:String,default:""},wrapStyle:{type:Object},headerTag:{type:String,default:"div"},footerTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},itemStyle:{type:Object},itemClass:{type:String,default:""},disabled:{type:Boolean,default:!1},draggable:{type:[Function,String]},dragging:{type:Function},ghostClass:{type:String,default:""},ghostStyle:{type:Object,default:function(){return{}}},chosenClass:{type:String,default:""},animation:{type:Number,default:150},autoScroll:{type:Boolean,default:!0},scrollStep:{type:Number,default:5},scrollThreshold:{type:Number,default:15},keepOffset:{type:Boolean,default:!1}},c={tag:{type:String,default:"div"},event:{type:String},dataKey:{type:[String,Number]},isHorizontal:{type:Boolean}},u=r(function t(){n(this,t),this.start=0,this.end=0,this.front=0,this.behind=0}),d=r(function t(){n(this,t),this.from={key:void 0,item:void 0,index:-1},this.to={key:void 0,item:void 0,index:-1}}),f=r(function t(){n(this,t),this.average=void 0,this.total=void 0,this.fixed=void 0,this.header=void 0,this.footer=void 0}),g="INIT",p="FIXED",m="DYNAMIC",v="FRONT",b="BEHIND";function S(t,e){this.options=t,this.callback=e,this.sizes=new Map,this.isHorizontal=t.isHorizontal,this.calcIndex=0,this.calcType=g,this.calcSize=new f,this.direction="",this.offset=0,this.range=new u,t&&this.checkIfUpdate(0,t.keeps-1)}S.prototype={construcrot:S,updateUniqueKeys:function(t){this.options.uniqueKeys=t},updateSizes:function(i){var n=this;this.sizes.forEach(function(t,e){i.includes(e)||n.sizes.delete(e)})},updateRange:function(){var t=this,e=Math.max(this.range.start,0),i=Math.min(this.options.keeps,this.options.uniqueKeys.length);this.sizes.size>=i-1?this.handleUpdate(e,this.getEndByStart(e)):window.requestAnimationFrame?window.requestAnimationFrame(function(){return t.updateRange()}):setTimeout(function(){return t.updateRange()},3)},handleScroll:function(t){this.direction=t<this.offset?v:b,this.offset=t;t=this.getScrollItems(t);this.isFront()?this.handleScrollFront(t):this.isBehind()&&this.handleScrollBehind(t)},isFront:function(){return this.direction===v},isBehind:function(){return this.direction===b},isFixed:function(){return this.calcType===p},getScrollItems:function(t){var e=this.calcSize,i=e.fixed,e=e.header;if(e&&(t-=e),t<=0)return 0;if(this.isFixed())return Math.floor(t/i);for(var n,o,r=0,s=this.options.uniqueKeys.length;r<=s;){if(n=r+Math.floor((s-r)/2),(o=this.getOffsetByIndex(n))===t)return n;o<t?r=n+1:t<o&&(s=n-1)}return 0<r?--r:0},handleScrollFront:function(t){t>this.range.start||(t=Math.max(t-Math.round(this.options.keeps/3),0),this.checkIfUpdate(t,this.getEndByStart(t)))},handleScrollBehind:function(t){t<this.range.start+Math.round(this.options.keeps/3)||this.checkIfUpdate(t,this.getEndByStart(t))},checkIfUpdate:function(t,e){var i=this.options,n=i.uniqueKeys,i=i.keeps;n.length<=i?(t=0,e=n.length-1):e-t<i-1&&(t=e-i+1),this.range.start!==t&&this.handleUpdate(t,e)},handleUpdate:function(t,e){this.range.start=t,this.range.end=e,this.range.front=this.getFrontOffset(),this.range.behind=this.getBehindOffset(),this.callback(y({},this.range))},getFrontOffset:function(){return this.isFixed()?this.calcSize.fixed*this.range.start:this.getOffsetByIndex(this.range.start)},getBehindOffset:function(){var t=this.getLastIndex();return this.isFixed()?(t-this.range.end)*this.calcSize.fixed:this.calcIndex===t?this.getOffsetByIndex(t)-this.getOffsetByIndex(this.range.end):(t-this.range.end)*this.getItemSize()},getOffsetByIndex:function(t){if(!t)return 0;for(var e=0,i=0;i<t;i++){var n=this.sizes.get(this.options.uniqueKeys[i]);e+="number"==typeof n?n:this.getItemSize()}return this.calcIndex=Math.max(this.calcIndex,t-1),this.calcIndex=Math.min(this.calcIndex,this.getLastIndex()),e},getEndByStart:function(t){return Math.min(t+this.options.keeps-1,this.getLastIndex())},getLastIndex:function(){var t=this.options,e=t.uniqueKeys,t=t.keeps;return 0<e.length?e.length-1:t-1},getItemSize:function(){return this.isFixed()?this.calcSize.fixed:this.calcSize.average||this.options.size},handleItemSizeChange:function(t,e){this.sizes.set(t,e),this.calcType===g?(this.calcType=p,this.calcSize.fixed=e):this.isFixed()&&this.calcSize.fixed!==e&&(this.calcType=m,this.calcSize.fixed=void 0),this.calcType!==p&&(this.calcSize.total=s(this.sizes.values()).reduce(function(t,e){return t+e},0),this.calcSize.average=Math.round(this.calcSize.total/this.sizes.size))},handleHeaderSizeChange:function(t){this.calcSize.header=t},handleFooterSizeChange:function(t){this.calcSize.footer=t}};(function(t){function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function r(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){var i;if(t)return"string"==typeof t?a(t,e):"Map"===(i="Object"===(i=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(t,e):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function e(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}function l(e,i){i?"none"===i?O.forEach(function(t){return b(e,t,"none")}):O.forEach(function(t){return b(e,t,"".concat(t.split("transition")[0],"transform ").concat(i))}):O.forEach(function(t){return b(e,t,"")})}function h(e,i){i?k.forEach(function(t){return b(e,t,"".concat(t.split("transform")[0]).concat(i))}):k.forEach(function(t){return b(e,t,"")})}function c(t){var e=t.touches&&t.touches[0]||t.pointerType&&"touch"===t.pointerType&&t,t=e||t;return{touch:e,e:t,target:e?document.elementFromPoint(t.clientX,t.clientY):t.target}}function u(t,e,i){window.addEventListener?t.addEventListener(e,i,!(!C&&D)&&z):window.attachEvent&&t.attachEvent("on"+e,i)}function d(t,e,i){window.removeEventListener?t.removeEventListener(e,i,!(!C&&D)&&z):window.detachEvent&&t.detachEvent("on"+e,i)}function f(t){for(var e={top:0,left:0,height:0,width:0},i=(e.height=t.offsetHeight,e.width=t.offsetWidth,e.top=t.offsetTop,e.left=t.offsetLeft,t.offsetParent);null!==i;)e.top+=i.offsetTop,e.left+=i.offsetLeft,i=i.offsetParent;return e}function g(t,e){if(t&&t.getBoundingClientRect){var i=t,n=!1;do{if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var o=b(i);if(i.clientWidth<i.scrollWidth&&("auto"==o.overflowX||"scroll"==o.overflowX)||i.clientHeight<i.scrollHeight&&("auto"==o.overflowY||"scroll"==o.overflowY)){if(!i.getBoundingClientRect||i===document.body)return p();if(n||e)return i;n=!0}}}while(i=i.parentNode)}return p()}function p(){var t=document.scrollingElement;return!t||t.contains(document.body)?document:t}function m(t){var e;if(t.getBoundingClientRect||t===window)return e={top:0,left:0,bottom:0,right:0,height:0,width:0},t!==window&&t.parentNode&&t!==p()?(t=t.getBoundingClientRect(),e.top=t.top,e.left=t.left,e.bottom=t.bottom,e.right=t.right,e.height=t.height,e.width=t.width):(e.top=0,e.left=0,e.bottom=window.innerHeight,e.right=window.innerWidth,e.height=window.innerHeight,e.width=window.innerWidth),e}function y(t,e,i){var n=r(Array.from(t.children)),t=n.indexOf(e);if(-1<t)return i?n[t]:{index:t,el:n[t],rect:m(n[t]),offset:f(n[t])};for(var o=0;o<n.length;o++)if(function(t,e){var i;if(t&&e)for(i=t.parentNode;i;){if(e===i)return 1;i=i.parentNode}return}(e,n[o]))return i?n[o]:{index:o,el:n[o],rect:m(n[o]),offset:f(n[o])};return i?null:{index:-1,el:null,rect:{},offset:{}}}function v(t,e,i){var n;t&&e&&(t.classList?t.classList[i?"add":"remove"](e):(n=(" "+t.className+" ").replace(I," ").replace(" "+e+" "," "),t.className=(n+(i?" "+e:"")).replace(I," ")))}function b(t,e,i){var n=t&&t.style;if(n){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(i=t.currentStyle),void 0===e?i:i[e];n[e=e in n||-1!==e.indexOf("webkit")?e:"-webkit-"+e]=i+("string"==typeof i?"":"px")}}function S(i,n,o){var r=null;return function(){var t=this,e=arguments;r&&clearTimeout(r),o&&!r&&i.apply(t,e),r=setTimeout(function(){i.apply(t,e)},n)}}function w(i,n){var o=null;return function(){var t=this,e=arguments;o=o||setTimeout(function(){o=null,i.apply(t,e)},n)}}function P(){var o=[];return{captureAnimationState:function(){var t=r(Array.from(this.rootEl.children)),e=(i=t,n=this.dragEl,e=this.dropEl,n=i.indexOf(n),i=i.indexOf(e),n<i?{start:n,end:i}:{start:i,end:n}),i=e.start,n=e.end;o.length=0,t.slice(i,n+1).forEach(function(t){o.push({target:t,rect:m(t)})})},animateRange:function(){var i=this;o.forEach(function(t){var e=t.target,t=t.rect;i.animate(e,t,i.options.animation)})},animate:function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:150,n=m(t),o=e.left-n.left,e=e.top-n.top;l(t,"none"),h(t,"translate3d(".concat(o,"px, ").concat(e,"px, 0)")),t.offsetLeft,l(t,"".concat(i,"ms")),h(t,"translate3d(0px, 0px, 0px)"),clearTimeout(t.animated),t.animated=setTimeout(function(){l(t,""),h(t,""),t.animated=null},i)}}}function E(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.rootEl=t,this.scrollEl=g(t,!0),this.options=e=Object.assign({},e),this.ownerDocument=t.ownerDocument;var i,n={autoScroll:!0,scrollStep:5,scrollThreshold:15,delay:0,delayOnTouchOnly:!1,disabled:!1,animation:150,ghostAnimation:0,ghostClass:"",ghostStyle:{},chosenClass:"",draggable:void 0,dragging:void 0,onDrag:void 0,onMove:void 0,onDrop:void 0,onChange:void 0,fallbackOnBody:!1,forceFallback:!1,stopPropagation:!1,supportPointer:"PointerEvent"in window&&!T,supportTouch:"ontouchstart"in window};for(i in n)i in this.options||(this.options[i]=n[i]);this.container=this.options.fallbackOnBody?document.body:this.rootEl,this.nativeDraggable=!this.options.forceFallback&&A,this.move={x:0,y:0},this.state=new $,this.differ=new K,this.ghost=new M(this),this.dragEl=null,this.dropEl=null,this.dragStartTimer=null,this.autoScrollTimer=null,Object.assign(this,{_bindEventListener:function(){this._onDrag=this._onDrag.bind(this),this._onMove=this._onMove.bind(this),this._onDrop=this._onDrop.bind(this);var t=this.options,e=t.supportPointer,t=t.supportTouch;u(this.rootEl,e?"pointerdown":t?"touchstart":"mousedown",this._onDrag)},_clearEvent:function(){d(this.rootEl,"pointerdown",this._onDrag),d(this.rootEl,"touchstart",this._onDrag),d(this.rootEl,"mousedown",this._onDrag)},_bindMoveEvents:function(t){this.options.supportPointer?u(this.ownerDocument,"pointermove",this._onMove):u(this.ownerDocument,t?"touchmove":"mousemove",this._onMove)},_unbindMoveEvents:function(){d(this.ownerDocument,"pointermove",this._onMove),d(this.ownerDocument,"touchmove",this._onMove),d(this.ownerDocument,"mousemove",this._onMove)},_unbindDropEvents:function(){d(this.ownerDocument,"pointerup",this._onDrop),d(this.ownerDocument,"pointercancel",this._onDrop),d(this.ownerDocument,"touchend",this._onDrop),d(this.ownerDocument,"touchcancel",this._onDrop),d(this.ownerDocument,"mouseup",this._onDrop)},_unbindDragEvents:function(){this.nativeDraggable&&(d(this.rootEl,"dragstart",this._onDragStart),d(this.rootEl,"dragover",this._onDragOver),d(this.rootEl,"dragend",this._onDrop))}},P(),(window.requestAnimationFrame||(window.requestAnimationFrame=function(t){return setTimeout(t,17)}),{_autoScroll:w(function(t){var e,i,n,o,r,s,a,l,h,c,u,d,f,g,p;t.state.sortableDown&&t.state.sortableMove&&(e=(i=t.state.sortableMove).clientX,i=i.clientY,void 0!==e)&&void 0!==i&&t.scrollEl!==t.ownerDocument&&(n=(g=t.scrollEl).scrollTop,o=g.scrollLeft,r=g.scrollHeight,g=g.scrollWidth,s=(f=m(t.scrollEl)).top,u=f.right,a=f.bottom,d=f.left,l=f.height,f=f.width,h=(c=t.options).scrollStep,c=c.scrollThreshold,d=0<o&&d<=e&&e<=d+c,f=o+f<g&&e<=u&&u-c<=e,g=n+l<r&&i<=a&&a-c<=i,p={x:o,y:n},(u=0<n&&s<=i&&i<=s+c)?(p.x=d?o-h:f?o+h:o,p.y=n-h):g?(p.x=d?o-h:f?o+h:o,p.y=n+h):d?(p.x=o-h,p.y=n):f&&(p.x=o+h,p.y=n),u||d||f||g)&&requestAnimationFrame(function(){t.scrollEl.scrollTo(p.x,p.y),t._autoScroll(t)})},10)})),this._bindEventListener()}var D,x,T,_,z,I,O,k,C,$,K,M,A;t.exports=(D=e(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),x=e(/Edge/i),T=e(/safari/i)&&!e(/chrome/i)&&!e(/android/i),t=e(/iP(ad|od|hone)/i),_=e(/chrome/i)&&e(/android/i),z={capture:!1,passive:!1},I=/\s+/g,O=["-webkit-transition","-moz-transition","-ms-transition","-o-transition","transition"],k=["-webkit-transform","-moz-transform","-ms-transform","-o-transform","transform"],C=function(){var t=!1;return document.addEventListener("checkIfSupportPassive",null,{get passive(){return t=!0}}),t}(),$=o(function t(){i(this,t),this.sortableDown=void 0,this.sortableMove=void 0,this.animationEnd=void 0}),K=function(){function t(){i(this,t),this.from={node:null,rect:{},offset:{}},this.to={node:null,rect:{},offset:{}}}return o(t,[{key:"get",value:function(t){return this[t]}},{key:"set",value:function(t,e){this[t]=e}},{key:"destroy",value:function(){this.from={node:null,rect:{},offset:{}},this.to={node:null,rect:{},offset:{}}}}]),t}(),M=function(){function e(t){i(this,e),this.$el=null,this.distance={x:0,y:0},this.options=t.options,this.container=t.container}return o(e,[{key:"init",value:function(t,e){var i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],t=(this.$el=t,this.options),n=t.ghostClass,t=t.ghostStyle,t=void 0===t?{}:t;v(this.$el,n,!0),b(this.$el,"box-sizing","border-box"),b(this.$el,"margin",0),b(this.$el,"top",e.top),b(this.$el,"left",e.left),b(this.$el,"width",e.width),b(this.$el,"height",e.height),b(this.$el,"opacity","0.8"),b(this.$el,"position","fixed"),b(this.$el,"zIndex","100000"),b(this.$el,"pointerEvents","none"),this.setStyle(t),l(this.$el,"none"),h(this.$el,"translate3d(0px, 0px, 0px)"),i&&this.container.appendChild(this.$el),b(this.$el,"transform-origin",this.distance.x/parseInt(this.$el.style.width)*100+"% "+this.distance.y/parseInt(this.$el.style.height)*100+"%")}},{key:"setStyle",value:function(t){for(var e in t)b(this.$el,e,t[e])}},{key:"rect",value:function(){return m(this.$el)}},{key:"move",value:function(t,e){this.$el&&(l(this.$el,2<arguments.length&&void 0!==arguments[2]&&arguments[2]?"".concat(this.options.ghostAnimation,"ms"):"none"),h(this.$el,"translate3d(".concat(t,"px, ").concat(e,"px, 0)")))}},{key:"destroy",value:function(t){var e,i,n=this;this.$el&&(i=parseInt(this.$el.style.left),e=parseInt(this.$el.style.top),this.move(t.left-i,t.top-e,!0),(i=this.options.ghostAnimation)?setTimeout(function(){return n.clear()},i):this.clear())}},{key:"clear",value:function(){this.$el&&this.$el.remove(),this.distance={x:0,y:0},this.$el=null}}]),e}(),A="undefined"!=typeof document&&!_&&!t&&"draggable"in document.createElement("div"),(E.prototype={constructor:E,destroy:function(){this._clearState(),this._clearEvent(),Array.prototype.forEach.call(this.rootEl.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")})},set:function(t,e){this.options[t]=e},get:function(t){return this.options[t]},_onDrag:function(t){var e=this;if(!(/mousedown|pointerdown/.test(t.type)&&0!==t.button||this.options.disabled)){var i=c(t),n=i.touch,o=i.e,i=i.target;if(this.nativeDraggable||!T||!i||"SELECT"!==i.tagName.toUpperCase()){if(i===this.rootEl)return!0;this.options.stopPropagation&&t.stopPropagation();var t=this.options,r=t.draggable,t=t.dragging;if("function"==typeof r){if(!r(o))return!0}else if("string"==typeof r){if(!function(t,e){if(e){if(">"===e[0]&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(t){}return}}(i,r))return!0}else if(void 0!==r)throw new Error('draggable expected "function" or "string" but received "'.concat(s(r),'"'));if(t){if("function"!=typeof t)throw new Error('dragging expected "function" or "string" but received "'.concat(s(t),'"'));this.dragEl=t(o)}else this.dragEl=y(this.rootEl,i,!0);if(!this.dragEl||this.dragEl.animated)return!0;n&&(this.dragEl.style["touch-action"]="none");r=y(this.rootEl,this.dragEl),t=r.rect,i=r.offset,r=(this.move={x:o.clientX,y:o.clientY},this.differ.from={node:this.dragEl,rect:t,offset:i},this.ghost.distance={x:o.clientX-t.left,y:o.clientY-t.top},this.state.sortableDown=o,u(this.ownerDocument,"pointerup",this._onDrop),u(this.ownerDocument,"touchend",this._onDrop),u(this.ownerDocument,"mouseup",this._onDrop),this.options),i=r.delay,t=r.delayOnTouchOnly;!i||t&&!n||this.nativeDraggable&&(x||D)?this._onStart(o,n):(clearTimeout(this.dragStartTimer),this.dragStartTimer=setTimeout(function(){return e._onStart(o,n)},i))}}},_onStart:function(t,e){!this.nativeDraggable||e?(this._bindMoveEvents(e),u(this.ownerDocument,"pointercancel",this._onDrop),u(this.ownerDocument,"touchcancel",this._onDrop)):(this.dragEl.draggable=!0,this._onDragStart=this._onDragStart.bind(this),this._onDragOver=this._onDragOver.bind(this),u(this.rootEl,"dragstart",this._onDragStart));try{document.selection?setTimeout(function(){document.selection.empty()},0):window.getSelection().removeAllRanges()}catch(t){}},_onDragStart:function(t){t.dataTransfer.setData("te",t.target.innerText),u(this.rootEl,"dragover",this._onDragOver),u(this.rootEl,"dragend",this._onDrop)},_onDragOver:function(t){var e,i,n,o;this.state.sortableDown&&(this.options.stopPropagation&&t.stopPropagation&&t.stopPropagation(),void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),e=t.clientX,i=t.clientY,n=e-this.move.x,o=i-this.move.y,void 0!==e&&Math.abs(n)<=0&&void 0!==i&&Math.abs(o)<=0||(this._onStarted(t,t),t.target!==this.rootEl&&this._onChange(this,t.target,t,t)))},_onMove:function(t){var e,i,n,o,r,s,a,l,h=this;this.state.sortableDown&&(e=(i=c(t)).e,i=i.target,n=e.clientX,o=e.clientY,s=n-this.move.x,r=o-this.move.y,void 0!==n&&Math.abs(s)<=0&&void 0!==o&&Math.abs(r)<=0||(this.options.stopPropagation&&t.stopPropagation&&t.stopPropagation(),void 0!==t.preventDefault&&t.cancelable&&t.preventDefault(),this._onStarted(e,t),this.ghost.move(s,r),(s=this.options.onMove)&&"function"==typeof s&&s(this.differ.from,this.ghost.$el,e,t),n<0)||o<0||(s=(r=m(this.rootEl)).top,a=r.right,l=r.bottom,n<r.left)||a<n||o<s||l<o||(this._onChange(this,i,e,t),this.autoScrollTimer&&clearTimeout(this.autoScrollTimer),this.options.autoScroll&&(this.autoScrollTimer=setTimeout(function(){return h._autoScroll(h)},0))))},_onStarted:function(t,e){var i;this.state.sortableMove=t,this.ghost.$el||((i=this.options.onDrag)&&"function"==typeof i&&i(this.dragEl,t,e),i=this.differ.from.rect,t=this.dragEl.cloneNode(!0),this.ghost.init(t,i,!this.nativeDraggable),v(this.dragEl,this.options.chosenClass,!0),this.dragEl.style["will-change"]="transform",T&&b(document.body,"user-select","none"),this.nativeDraggable&&this._unbindDropEvents())},_onChange:S(function(t,e,i,n){var o,r,s,a,l,h,e=y(t.rootEl,e),c=e.el,u=e.rect,e=e.offset;c&&!c.animated&&(t.dropEl=c,h=i.clientX,o=i.clientY,l=u.left,r=u.right,s=u.top,a=u.bottom,l<h)&&h<r&&s<o&&o<a&&c!==t.dragEl&&(t.differ.to={node:t.dropEl,rect:u,offset:e},t.captureAnimationState(),l=t.options.onChange,h=f(t.dragEl),l&&"function"==typeof l&&l(t.differ.from,t.differ.to,i,n),h.top<e.top||h.left<e.left?t.rootEl.insertBefore(t.dragEl,c.nextElementSibling):t.rootEl.insertBefore(t.dragEl,c),t.animateRange())},5),_onDrop:function(t){this._unbindDragEvents(),this._unbindMoveEvents(),this._unbindDropEvents(),this.dragStartTimer&&clearTimeout(this.dragStartTimer),this.options.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault();var e,i=c(t).touch;v(this.dragEl,this.options.chosenClass,!1),this.nativeDraggable&&(this.dragEl.draggable=!1),i&&(this.dragEl.style["touch-action"]=""),this.dragEl.style["will-change"]="",this.state.sortableDown&&this.state.sortableMove&&(this.differ.to.offset=f(this.dragEl),this.differ.to.rect=m(this.dragEl),e=(i=this.differ).from,i=i.to,e=e.offset.top!==i.offset.top||e.offset.left!==i.offset.left,i=this.options.onDrop)&&"function"==typeof i&&i(e,t),T&&b(document.body,"user-select",""),this.ghost.destroy(this.differ.to.rect),this.state=new $},_clearState:function(){this.state=new $,this.differ.destroy(),this.dragEl=null,this.dropEl=null}}).utils={getRect:m,getOffset:f,debounce:S,throttle:w,getParentAutoScrollElement:g},E)})(D={exports:{}});var w=D.exports;function E(t,e,i){this.options=t,this.onDrag=e,this.onDrop=i,this.list=t.list,this.cloneList=new Array,this.drag=null,this.dragElement=null,this.rangeIsChanged=!1,this.dragState=new d,this.init()}E.prototype={constructor:E,set:function(t,e){"list"===t?(this.list=e,this.dragElement&&this.dragStart(this.dragElement,!1)):(this.options[t]=e,this.drag.set(t,e))},init:function(){var i=this,t=this.options,e=t.disabled,n=t.dragging,o=t.draggable,r=t.ghostClass,s=t.ghostStyle,a=t.chosenClass,l=t.animation,h=t.autoScroll,c=t.scrollStep,t=t.scrollThreshold;this.drag=new w(this.options.scrollEl,{disabled:e,dragging:n,draggable:o,ghostClass:r,ghostStyle:s,chosenClass:a,animation:l,autoScroll:h,scrollStep:c,scrollThreshold:t,onChange:function(t,e){return i.onChange(t,e)},onDrag:function(t){return i.dragStart(t)},onDrop:function(t){return i.dragEnd(t)}})},dragStart:function(t){var i=this,e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=(this.dragElement=t,this.cloneList=s(this.list),t.getAttribute("data-key"));this.list.forEach(function(t,e){i.options.getDataKey(t)==n&&Object.assign(i.dragState.from,{item:t,index:e,key:n})}),e?(this.rangeIsChanged=!1,this.onDrag(this.dragState.from,t)):this.rangeIsChanged=!0},onChange:function(t,e){var n=this,o=this.dragState.from.key,r=e.node.getAttribute("data-key"),s={item:null,index:-1},a={item:null,index:-1};this.cloneList.forEach(function(t,e){var i=n.options.getDataKey(t);i==o&&Object.assign(s,{item:t,index:e}),i==r&&Object.assign(a,{item:t,index:e})}),this.cloneList.splice(s.index,1),this.cloneList.splice(a.index,0,s.item)},dragEnd:function(t){var i=this,n=(this.rangeIsChanged&&this.dragElement&&this.dragElement.remove(),this.options.getDataKey),o=this.dragState.from;this.cloneList.forEach(function(t,e){n(t)==o.key&&(i.dragState.to={index:e,item:i.list[e],key:n(t)})}),this.onDrop(this.cloneList,o,this.dragState.to,t),this.list=s(this.cloneList),this.clear()},clear:function(){this.dragElement=null,this.rangeIsChanged=!1,this.dragState=new d},destroy:function(){this.drag&&this.drag.destroy(),this.drag=null}};var D={inject:["virtualList"],data:function(){return{observer:null}},mounted:function(){var t=this;"undefined"!=typeof ResizeObserver&&(this.observer=new ResizeObserver(function(){t.onSizeChange()}),this.$el)&&this.observer.observe(this.$el)},updated:function(){this.onSizeChange()},beforeDestroy:function(){this.observer&&(this.observer.disconnect(),this.observer=null)},methods:{onSizeChange:function(){this.virtualList[this.event](this.dataKey,this.getCurrentSize())},getCurrentSize:function(){var t=this.isHorizontal?"offsetWidth":"offsetHeight";return this.$el?this.$el[t]:0}}},x=t.default.component("virtual-draglist-items",{mixins:[D],props:c,render:function(t){var e=this.tag,i=this.dataKey;return t(e,{key:i,attrs:{"data-key":i}},this.$slots.default)}}),T=t.default.component("virtual-draglist-slots",{mixins:[D],props:c,render:function(t){var e=this.tag,i=this.dataKey;return t(e,{key:i,attrs:{role:i}},this.$slots.default)}});function _(r,t,e){function i(){for(var t,e=this,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return h&&clearTimeout(h),l?(t=!h,h=setTimeout(function(){h=null},a),t&&(s=r.apply(this,n))):h=setTimeout(function(){r.apply(e,n)},a),s}var s,a=1<arguments.length&&void 0!==t?t:50,l=2<arguments.length&&void 0!==e&&e,h=null;return i.cancel=function(){clearTimeout(h),h=null},i}return t.default.component("virtual-drag-list",{props:h,data:function(){return{list:[],uniqueKeys:[],virtual:null,sortable:null,lastItem:null,range:new u,dragState:new d}},provide:function(){return{virtualList:this}},computed:{isHorizontal:function(){return"vertical"!==this.direction},scrollSizeKey:function(){return this.isHorizontal?"scrollWidth":"scrollHeight"},scrollDirectionKey:function(){return this.isHorizontal?"scrollLeft":"scrollTop"},offsetSizeKey:function(){return this.isHorizontal?"offsetLeft":"offsetTop"},clientSizeKey:function(){return this.isHorizontal?"clientWidth":"clientHeight"}},watch:{dataSource:{handler:function(t){this.init(t)},deep:!0,immediate:!0},disabled:{handler:function(t){this.sortable&&this.sortable.set("disabled",t)},immediate:!0}},created:function(){var i,n,o,t=this;this.range.end=this.keeps-1,this._clearDragState=(i=function(){t.dragState=new d},n=this.delay+17,o=null,function(){var t=this,e=arguments;o=o||setTimeout(function(){o=null,i.apply(t,e)},n)})},beforeDestroy:function(){this._destroySortable()},methods:{reset:function(){this.scrollToTop(),this.init(this.dataSource)},getSize:function(t){return this.virtual.sizes.get(t)},getOffset:function(){var t=this.$refs.root;return t?Math.ceil(t[this.scrollDirectionKey]):0},scrollToTop:function(){this.$refs.root[this.scrollDirectionKey]=0},scrollToBottom:function(){var t=this,e=this.$refs,i=e.bottomItem,n=e.root;i&&(e=i[this.offsetSizeKey],this.scrollToOffset(e),setTimeout(function(){t.getOffset()+Math.ceil(n[t.clientSizeKey])<Math.ceil(n[t.scrollSizeKey])&&t.scrollToBottom()},5))},scrollToIndex:function(t){var e,i=this;t>=this.list.length-1?this.scrollToBottom():(e=this.virtual.getOffsetByIndex(t),this.scrollToOffset(e),setTimeout(function(){i.getOffset()!==i.virtual.getOffsetByIndex(t)&&i.scrollToIndex(t)},5))},scrollToOffset:function(t){this.$refs.root[this.scrollDirectionKey]=t},handleDragEnd:function(t,e,i,n){this.$emit("ondragend",t,e,i,n)},init:function(t){var e=this;this.list=s(t),this._updateUniqueKeys(),this.virtual?(this.virtual.updateUniqueKeys(this.uniqueKeys),this.virtual.updateSizes(this.uniqueKeys),this.virtual.updateRange()):this._initVirtual(),this.sortable?this.sortable.set("list",s(t)):this.$nextTick(function(){return e._initSortable()}),this.lastItem&&this.keepOffset&&(t=this._getItemIndex(this.lastItem),this.scrollToIndex(t),this.lastItem=null)},_initVirtual:function(){var n=this;this.virtual=new S({size:this.size,keeps:this.keeps,uniqueKeys:this.uniqueKeys,isHorizontal:this.isHorizontal},function(t){void 0===n.dragState.to.key&&(n.range=t);var t=n.range,e=t.start,t=t.end,i=n.dragState.from.index;-1<i&&!(e<=i&&i<=t)&&n.sortable&&(n.sortable.rangeIsChanged=!0)}),this.virtual.updateSizes(this.uniqueKeys),this.virtual.updateRange()},_initSortable:function(){var o=this;this.sortable=new E({scrollEl:this.$refs.group,getDataKey:this._getDataKey,list:this.list,disabled:this.disabled,dragging:this.dragging,draggable:this.draggable,ghostClass:this.ghostClass,ghostStyle:this.ghostStyle,chosenClass:this.chosenClass,animation:this.animation,autoScroll:this.autoScroll,scrollStep:this.scrollStep,scrollThreshold:this.scrollThreshold},function(t,e){o.dragState.from=t,o.$emit("ondragstart",o.list,t,e)},function(t,e,i,n){o.dragState.to=i,o.handleDragEnd(t,e,i,n),n&&(o.sortable.rangeIsChanged&&o.virtual.direction&&0<o.range.start&&-1<(e=t.indexOf(o.list[o.range.start]))&&(o.range.start=e,o.range.end=e+o.keeps-1),o.list=s(t),o._updateUniqueKeys(),o.virtual.updateUniqueKeys(o.uniqueKeys)),o._clearDragState()})},_destroySortable:function(){this.sortable&&this.sortable.destroy(),this.sortable=null},_handleScroll:function(){var t,e,i;void 0!==this.dragState.to.key?this._clearDragState():(i=this.$refs.root,t=this.getOffset(),e=Math.ceil(i[this.clientSizeKey]),!(i=Math.ceil(i[this.scrollSizeKey]))||t<0||i+1<t+e||(this.virtual.handleScroll(t),this.virtual.isFront()?this.list.length&&t<=0&&this.handleToTop(this):this.virtual.isBehind()&&i<=e+t&&this.handleToBottom(this)))},handleToTop:_(function(t){t.$emit("top"),t.lastItem=t.list[0]}),handleToBottom:_(function(t){t.$emit("bottom")}),_onItemResized:function(t,e){this.virtual.handleItemSizeChange(t,e)},_onHeaderResized:function(t,e){this.virtual.handleHeaderSizeChange(e)},_onFooterResized:function(t,e){this.virtual.handleFooterSizeChange(e)},_updateUniqueKeys:function(){var e=this;this.uniqueKeys=this.list.map(function(t){return e._getDataKey(t)})},_getDataKey:function(t){var e=this.dataKey;return(Array.isArray(e)?e:e.replace(/\[/g,".").replace(/\]/g,".").split(".")).reduce(function(t,e){return(t||{})[e]},t)},_getItemIndex:function(e){var i=this;return this.list.findIndex(function(t){return i._getDataKey(e)==i._getDataKey(t)})},_getItemStyle:function(t){var e=this.dragState.from.key;return this.sortable&&this.sortable.rangeIsChanged&&t==e?{display:"none"}:{}}},render:function(n){var o=this,t=this.$slots,e=t.header,t=t.footer,i=this.range,r=i.start,s=i.end,a=i.front,i=i.behind,l=this.isHorizontal,h=this.headerTag,c=this.footerTag,u=this.itemTag,d=this.rootTag,f=this.wrapTag,g=this.itemStyle,p=this.itemClass,m=this.wrapClass,a=y(y({},this.wrapStyle),{},{padding:l?"0px ".concat(i,"px 0px ").concat(a,"px"):"".concat(a,"px 0px ").concat(i,"px")});return n(d,{ref:"root",style:{overflow:l?"auto hidden":"hidden auto"},on:{"&scroll":_(this._handleScroll,this.delay)}},[e?n(T,{props:{tag:h,dataKey:"header",event:"_onHeaderResized"}},e):null,n(f,{ref:"group",attrs:{role:"group"},class:m,style:a},this.list.slice(r,s+1).map(function(t){var e=o._getItemIndex(t),i=o._getDataKey(t);return o.$scopedSlots.item?n(x,{key:i,props:{isHorizontal:l,dataKey:i,tag:u,event:"_onItemResized"},style:y(y({},g),o._getItemStyle(i)),class:p},o.$scopedSlots.item({record:t,index:e,dataKey:i})):n(u,{key:i,attrs:{"data-key":i},style:y(y({},g),{},{height:"".concat(o.size,"px")}),class:p},i)})),t?n(T,{props:{tag:c,dataKey:"footer",event:"_onFooterResized"}},t):null,n("div",{ref:"bottomItem",style:{width:l?"0px":"100%",height:l?"100%":"0px"}})])}})});
